<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Git Repository Analyzer</title>
  <link
    href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Literata:wght@300;400;600;700&display=swap"
    rel="stylesheet">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'IBM Plex Mono', 'Courier New', monospace;
    }

    .tooltip {
      position: absolute;
      background: rgba(26, 26, 26, 0.95);
      color: #FAF9F6;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 13px;
      pointer-events: none;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      max-width: 400px;
      border: 2px solid #fff;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-30px) scale(0.95);
      }

      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
  </style>
</head>

<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const InfoModal = ({ title, explanation, criteria }) => {
      const [showModal, setShowModal] = useState(false);

      return (
        <>
          <span
            onClick={() => setShowModal(true)}
            style={{
              display: 'inline-flex',
              alignItems: 'center',
              justifyContent: 'center',
              width: '20px',
              height: '20px',
              borderRadius: '50%',
              background: '#666',
              color: '#fff',
              fontSize: '13px',
              fontWeight: 'bold',
              cursor: 'pointer',
              marginLeft: '8px',
              transition: 'all 0.2s'
            }}
            onMouseEnter={(e) => e.target.style.background = '#1A1A1A'}
            onMouseLeave={(e) => e.target.style.background = '#666'}
            title="Click for details"
          >
            ?
          </span>

          {showModal && (
            <div
              onClick={() => setShowModal(false)}
              style={{
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                background: 'rgba(0, 0, 0, 0.85)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                zIndex: 10000,
                padding: '20px',
                cursor: 'pointer',
                animation: 'fadeIn 0.2s ease-out'
              }}
            >
              <div
                onClick={(e) => e.stopPropagation()}
                style={{
                  background: '#FFFFFF',
                  borderRadius: '12px',
                  maxWidth: '700px',
                  width: '100%',
                  maxHeight: '80vh',
                  overflow: 'auto',
                  boxShadow: '0 20px 60px rgba(0,0,0,0.5)',
                  cursor: 'default',
                  position: 'relative',
                  animation: 'slideIn 0.3s ease-out'
                }}
              >
                <button
                  onClick={() => setShowModal(false)}
                  style={{
                    position: 'absolute',
                    top: '20px',
                    right: '20px',
                    background: '#E8E8E8',
                    border: 'none',
                    borderRadius: '50%',
                    width: '36px',
                    height: '36px',
                    fontSize: '20px',
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    transition: 'all 0.2s',
                    fontWeight: '300',
                    color: '#666'
                  }}
                  onMouseEnter={(e) => {
                    e.target.style.background = '#1A1A1A';
                    e.target.style.color = '#fff';
                  }}
                  onMouseLeave={(e) => {
                    e.target.style.background = '#E8E8E8';
                    e.target.style.color = '#666';
                  }}
                >
                  Ã—
                </button>

                <div style={{ padding: '40px' }}>
                  <h2 style={{
                    margin: '0 0 24px',
                    fontSize: '32px',
                    fontWeight: '700',
                    color: '#1A1A1A',
                    fontFamily: 'Literata, serif',
                    paddingRight: '40px'
                  }}>
                    {title}
                  </h2>

                  <div style={{
                    fontSize: '16px',
                    lineHeight: '1.8',
                    color: '#333',
                    marginBottom: '32px',
                    fontFamily: 'IBM Plex Mono'
                  }}>
                    {explanation}
                  </div>

                  {criteria && criteria.length > 0 && (
                    <div>
                      <h3 style={{
                        fontSize: '14px',
                        fontWeight: '600',
                        textTransform: 'uppercase',
                        letterSpacing: '1px',
                        color: '#666',
                        marginBottom: '16px'
                      }}>
                        How We Detected This:
                      </h3>
                      <div style={{
                        background: '#F5F5F5',
                        borderRadius: '8px',
                        padding: '20px',
                        borderLeft: '4px solid #1A1A1A'
                      }}>
                        {criteria.map((c, i) => (
                          <div
                            key={i}
                            style={{
                              fontSize: '14px',
                              marginBottom: '12px',
                              paddingLeft: '8px',
                              color: '#333',
                              fontFamily: 'IBM Plex Mono',
                              lineHeight: '1.6'
                            }}
                          >
                            {c}
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  <div style={{
                    marginTop: '32px',
                    padding: '16px',
                    background: '#F0F0F0',
                    borderRadius: '8px',
                    fontSize: '13px',
                    color: '#666',
                    textAlign: 'center'
                  }}>
                    Click anywhere outside this box to close
                  </div>
                </div>
              </div>
            </div>
          )}
        </>
      );
    };
    const BranchDiagram = ({ commits, primaryBranch, compact = false, onCommitClick }) => {
      const svgRef = useRef(null);

      useEffect(() => {
        if (!svgRef.current || !commits || commits.length === 0) return;

        const svg = svgRef.current;
        while (svg.firstChild) {
          svg.removeChild(svg.firstChild);
        }

        const nodeSpacing = compact ? 40 : 60;
        const laneWidth = compact ? 60 : 80;
        const padding = 60;
        const canvasHeight = Math.max(commits.length * nodeSpacing + padding * 2, 600);

        svg.setAttribute('width', '100%');
        svg.setAttribute('height', canvasHeight);
        svg.setAttribute('viewBox', `0 0 1200 ${canvasHeight}`);

        // Assign lanes
        const lanes = new Map();
        const branchLanes = new Map();
        const centerLane = 5;
        branchLanes.set(primaryBranch, centerLane);
        let nextLane = centerLane + 1;

        commits.forEach((node, idx) => {
          const isOnPrimary = node.branches.includes(primaryBranch);
          if (isOnPrimary) {
            lanes.set(idx, centerLane);
          } else {
            let lane = null;
            for (const branch of node.branches) {
              if (branchLanes.has(branch)) {
                lane = branchLanes.get(branch);
                break;
              }
            }
            if (lane === null && node.branches[0]) {
              lane = nextLane++;
              branchLanes.set(node.branches[0], lane);
            }
            lanes.set(idx, lane || centerLane);
          }
        });

        const colors = ['#2D6A4F', '#C9184A', '#1A1A1A', '#7209B7', '#0077B6', '#FFC75F', '#FF6B9D', '#845EC2'];

        // Draw connections
        commits.forEach((node, idx) => {
          const y = idx * nodeSpacing + padding;
          const lane = lanes.get(idx) || centerLane;
          const x = lane * laneWidth + padding + 200;

          node.parents.forEach(parentHash => {
            const parentIdx = commits.findIndex(n => n.hash === parentHash);
            if (parentIdx !== -1 && parentIdx > idx) {
              const parentY = parentIdx * nodeSpacing + padding;
              const parentLane = lanes.get(parentIdx) || centerLane;
              const parentX = parentLane * laneWidth + padding + 200;
              const color = colors[lane % colors.length];

              const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
              if (lane === parentLane) {
                path.setAttribute('d', `M ${x} ${y} L ${parentX} ${parentY}`);
              } else {
                const midY = (y + parentY) / 2;
                path.setAttribute('d', `M ${x} ${y} C ${x} ${midY}, ${parentX} ${midY}, ${parentX} ${parentY}`);
              }
              path.setAttribute('stroke', color);
              path.setAttribute('stroke-width', '3');
              path.setAttribute('fill', 'none');
              path.setAttribute('opacity', '0.6');
              svg.appendChild(path);
            }
          });
        });

        // Draw commit dots
        commits.forEach((node, idx) => {
          const y = idx * nodeSpacing + padding;
          const lane = lanes.get(idx) || centerLane;
          const x = lane * laneWidth + padding + 200;
          const isOnPrimary = node.branches.includes(primaryBranch);
          const color = colors[lane % colors.length];

          const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
          g.setAttribute('cursor', 'pointer');

          const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
          circle.setAttribute('cx', x);
          circle.setAttribute('cy', y);
          circle.setAttribute('r', node.isMerge ? 7 : 5);
          circle.setAttribute('fill', isOnPrimary ? '#1A1A1A' : color);
          circle.setAttribute('stroke', '#fff');
          circle.setAttribute('stroke-width', '2');

          // Add click handler
          g.addEventListener('click', (e) => {
            e.stopPropagation();
            if (onCommitClick) {
              onCommitClick(node);
            } else if (window.repoInfo) {
              window.open(`https://github.com/${window.repoInfo.owner}/${window.repoInfo.repo}/commit/${node.fullHash}`, '_blank');
            }
          });

          // Hover effect
          g.addEventListener('mouseenter', () => {
            circle.setAttribute('r', node.isMerge ? 10 : 8);
          });
          g.addEventListener('mouseleave', () => {
            circle.setAttribute('r', node.isMerge ? 7 : 5);
          });

          g.appendChild(circle);
          svg.appendChild(g);
        });

        // Branch labels
        if (!compact) {
          branchLanes.forEach((lane, branchName) => {
            const x = lane * laneWidth + padding + 200;
            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', x);
            text.setAttribute('y', 30);
            text.setAttribute('fill', colors[lane % colors.length]);
            text.setAttribute('font-size', '12');
            text.setAttribute('font-weight', 'bold');
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('font-family', 'IBM Plex Mono');
            text.textContent = branchName;
            svg.appendChild(text);
          });
        }
      }, [commits, primaryBranch, compact, onCommitClick]);

      return <svg ref={svgRef} style={{ display: 'block', width: '100%' }} />;
    };
    const SortableListModal = ({ title, items, onClose, explanation, criteria, isInfo, isDiagram, primaryBranch }) => {
      // If it's an info modal, show InfoModal instead
      if (isInfo) {
        return (
          <div
            onClick={onClose}
            style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              background: 'rgba(0, 0, 0, 0.85)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 10000,
              padding: '20px',
              cursor: 'pointer',
              animation: 'fadeIn 0.2s ease-out'
            }}
          >
            <div
              onClick={(e) => e.stopPropagation()}
              style={{
                background: '#FFFFFF',
                borderRadius: '12px',
                maxWidth: '700px',
                width: '100%',
                maxHeight: '80vh',
                overflow: 'auto',
                boxShadow: '0 20px 60px rgba(0,0,0,0.5)',
                cursor: 'default',
                position: 'relative',
                animation: 'slideIn 0.3s ease-out'
              }}
            >
              <button
                onClick={onClose}
                style={{
                  position: 'absolute',
                  top: '20px',
                  right: '20px',
                  background: '#E8E8E8',
                  border: 'none',
                  borderRadius: '50%',
                  width: '36px',
                  height: '36px',
                  fontSize: '20px',
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  transition: 'all 0.2s',
                  fontWeight: '300',
                  color: '#666'
                }}
                onMouseEnter={(e) => {
                  e.target.style.background = '#1A1A1A';
                  e.target.style.color = '#fff';
                }}
                onMouseLeave={(e) => {
                  e.target.style.background = '#E8E8E8';
                  e.target.style.color = '#666';
                }}
              >
                Ã—
              </button>

              <div style={{ padding: '40px' }}>
                <h2 style={{
                  margin: '0 0 24px',
                  fontSize: '32px',
                  fontWeight: '700',
                  color: '#1A1A1A',
                  fontFamily: 'Literata, serif',
                  paddingRight: '40px'
                }}>
                  {title}
                </h2>

                <div style={{
                  fontSize: '16px',
                  lineHeight: '1.8',
                  color: '#333',
                  marginBottom: '32px',
                  fontFamily: 'IBM Plex Mono'
                }}>
                  {explanation}
                </div>

                {criteria && criteria.length > 0 && (
                  <div>
                    <h3 style={{
                      fontSize: '14px',
                      fontWeight: '600',
                      textTransform: 'uppercase',
                      letterSpacing: '1px',
                      color: '#666',
                      marginBottom: '16px'
                    }}>
                      How We Detected This:
                    </h3>
                    <div style={{
                      background: '#F5F5F5',
                      borderRadius: '8px',
                      padding: '20px',
                      borderLeft: '4px solid #1A1A1A'
                    }}>
                      {criteria.map((c, i) => (
                        <div
                          key={i}
                          style={{
                            fontSize: '14px',
                            marginBottom: '12px',
                            paddingLeft: '8px',
                            color: '#333',
                            fontFamily: 'IBM Plex Mono',
                            lineHeight: '1.6'
                          }}
                        >
                          {c}
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                <div style={{
                  marginTop: '32px',
                  padding: '16px',
                  background: '#F0F0F0',
                  borderRadius: '8px',
                  fontSize: '13px',
                  color: '#666',
                  textAlign: 'center'
                }}>
                  Click anywhere outside this box to close
                </div>
              </div>
            </div>
          </div>
        );
      }
      if (isDiagram) {
        return (
          <div
            onClick={onClose}
            style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              background: 'rgba(0, 0, 0, 0.85)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 10000,
              padding: '20px',
              cursor: 'pointer',
              animation: 'fadeIn 0.2s ease-out'
            }}
          >
            <div
              onClick={(e) => e.stopPropagation()}
              style={{
                background: '#FFFFFF',
                borderRadius: '12px',
                maxWidth: '1400px',
                width: '100%',
                height: '90vh',
                overflow: 'hidden',
                boxShadow: '0 20px 60px rgba(0,0,0,0.5)',
                cursor: 'default',
                position: 'relative',
                animation: 'slideIn 0.3s ease-out',
                display: 'flex',
                flexDirection: 'column'
              }}
            >
              <div style={{ padding: '32px 40px 24px', borderBottom: '2px solid #E8E8E8', flexShrink: 0 }}>
                <button
                  onClick={onClose}
                  style={{
                    position: 'absolute',
                    top: '20px',
                    right: '20px',
                    background: '#E8E8E8',
                    border: 'none',
                    borderRadius: '50%',
                    width: '36px',
                    height: '36px',
                    fontSize: '20px',
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    transition: 'all 0.2s',
                    fontWeight: '300',
                    color: '#666',
                    zIndex: 1
                  }}
                  onMouseEnter={(e) => {
                    e.target.style.background = '#1A1A1A';
                    e.target.style.color = '#fff';
                  }}
                  onMouseLeave={(e) => {
                    e.target.style.background = '#E8E8E8';
                    e.target.style.color = '#666';
                  }}
                >
                  Ã—
                </button>

                <h2 style={{
                  margin: '0',
                  fontSize: '28px',
                  fontWeight: '700',
                  color: '#1A1A1A',
                  fontFamily: 'Literata, serif',
                  paddingRight: '50px'
                }}>
                  {title}
                </h2>
                <div style={{ fontSize: '14px', color: '#666', marginTop: '8px' }}>
                  Showing {items.length} commits â€¢ Scroll to see full history â€¢ Click any commit to open on GitHub
                </div>
              </div>

              <div style={{
                flex: 1,
                overflow: 'auto',
                background: '#FAFAFA',
                position: 'relative'
              }}>
                <div style={{
                  minHeight: '100%',
                  padding: '40px 20px'
                }}>
                  <BranchDiagram
                    commits={items}
                    primaryBranch={primaryBranch}
                    compact={false}
                  />
                </div>
              </div>

              <div style={{
                padding: '16px 40px',
                borderTop: '2px solid #E8E8E8',
                background: '#F5F5F5',
                flexShrink: 0
              }}>
                <div style={{ fontSize: '13px', color: '#666', display: 'flex', alignItems: 'center', gap: '20px' }}>
                  <span><strong>ðŸ’¡ Tips:</strong></span>
                  <span>â€¢ Click commits to view on GitHub</span>
                  <span>â€¢ Scroll to see full history</span>
                  <span>â€¢ Lines show branch relationships</span>
                </div>
              </div>
            </div>
          </div>
        );
      }
      const [sortBy, setSortBy] = useState('commits');
      const [sortOrder, setSortOrder] = useState('desc');

      const getSortOptions = () => {
        if (!items || items.length === 0) return [];

        const firstItem = items[0];
        const options = [];

        if (firstItem.commits !== undefined) options.push({ value: 'commits', label: 'Commits' });
        if (firstItem.additions !== undefined) options.push({ value: 'additions', label: 'Additions' });
        if (firstItem.deletions !== undefined) options.push({ value: 'deletions', label: 'Deletions' });
        if (firstItem.merges !== undefined) options.push({ value: 'merges', label: 'Merges' });
        if (firstItem.name !== undefined) options.push({ value: 'name', label: 'Name' });
        if (firstItem.email !== undefined) options.push({ value: 'email', label: 'Email' });
        if (firstItem.branches !== undefined) options.push({ value: 'branches', label: 'Branches' });
        if (firstItem.author !== undefined) options.push({ value: 'author', label: 'Author' });
        if (firstItem.subject !== undefined) options.push({ value: 'subject', label: 'Message' });
        if (firstItem.timestamp !== undefined) options.push({ value: 'timestamp', label: 'Date' });

        return options;
      };

      const sortOptions = getSortOptions();

      const getSortedItems = () => {
        if (!items) return [];

        const sorted = [...items].sort((a, b) => {
          let aVal = a[sortBy];
          let bVal = b[sortBy];

          if (sortBy === 'branches' && Array.isArray(aVal)) {
            aVal = aVal.length;
            bVal = bVal.length;
          }

          if (typeof aVal === 'string') {
            return sortOrder === 'asc'
              ? aVal.localeCompare(bVal)
              : bVal.localeCompare(aVal);
          }

          return sortOrder === 'asc' ? aVal - bVal : bVal - aVal;
        });

        return sorted;
      };

      const sortedItems = getSortedItems();

      return (
        <div
          onClick={onClose}
          style={{
            position: 'fixed',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            background: 'rgba(0, 0, 0, 0.85)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 10000,
            padding: '20px',
            cursor: 'pointer',
            animation: 'fadeIn 0.2s ease-out'
          }}
        >
          <div
            onClick={(e) => e.stopPropagation()}
            style={{
              background: '#FFFFFF',
              borderRadius: '12px',
              maxWidth: '900px',
              width: '100%',
              maxHeight: '85vh',
              overflow: 'hidden',
              boxShadow: '0 20px 60px rgba(0,0,0,0.5)',
              cursor: 'default',
              position: 'relative',
              animation: 'slideIn 0.3s ease-out',
              display: 'flex',
              flexDirection: 'column'
            }}
          >
            <div style={{ padding: '32px 40px 24px', borderBottom: '2px solid #E8E8E8' }}>
              <button
                onClick={onClose}
                style={{
                  position: 'absolute',
                  top: '20px',
                  right: '20px',
                  background: '#E8E8E8',
                  border: 'none',
                  borderRadius: '50%',
                  width: '36px',
                  height: '36px',
                  fontSize: '20px',
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  transition: 'all 0.2s',
                  fontWeight: '300',
                  color: '#666'
                }}
                onMouseEnter={(e) => {
                  e.target.style.background = '#1A1A1A';
                  e.target.style.color = '#fff';
                }}
                onMouseLeave={(e) => {
                  e.target.style.background = '#E8E8E8';
                  e.target.style.color = '#666';
                }}
              >
                Ã—
              </button>

              <h2 style={{
                margin: '0 0 20px',
                fontSize: '28px',
                fontWeight: '700',
                color: '#1A1A1A',
                fontFamily: 'Literata, serif',
                paddingRight: '50px'
              }}>
                {title}
              </h2>

              <div style={{ display: 'flex', gap: '12px', alignItems: 'center', flexWrap: 'wrap' }}>
                <span style={{ fontSize: '14px', color: '#666', fontWeight: '600' }}>Sort by:</span>
                <select
                  value={sortBy}
                  onChange={(e) => setSortBy(e.target.value)}
                  style={{
                    padding: '8px 12px',
                    fontSize: '14px',
                    border: '2px solid #E8E8E8',
                    borderRadius: '6px',
                    background: '#FAFAFA',
                    cursor: 'pointer',
                    fontFamily: 'IBM Plex Mono'
                  }}
                >
                  {sortOptions.map(opt => (
                    <option key={opt.value} value={opt.value}>{opt.label}</option>
                  ))}
                </select>

                <button
                  onClick={() => setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc')}
                  style={{
                    padding: '8px 16px',
                    fontSize: '14px',
                    border: '2px solid #E8E8E8',
                    borderRadius: '6px',
                    background: '#1A1A1A',
                    color: '#fff',
                    cursor: 'pointer',
                    fontWeight: '600',
                    fontFamily: 'IBM Plex Mono'
                  }}
                >
                  {sortOrder === 'asc' ? 'â†‘ Ascending' : 'â†“ Descending'}
                </button>

                <span style={{ fontSize: '13px', color: '#999', marginLeft: 'auto' }}>
                  {sortedItems.length} items
                </span>
              </div>
            </div>

            <div style={{ flex: 1, overflow: 'auto', padding: '20px 40px 40px' }}>
              {sortedItems.map((item, idx) => (
                <div
                  key={idx}
                  style={{
                    padding: '16px',
                    marginBottom: '12px',
                    background: '#F5F5F5',
                    border: '1px solid #E8E8E8',
                    borderRadius: '8px',
                    transition: 'all 0.2s'
                  }}
                  onMouseEnter={(e) => {
                    e.currentTarget.style.background = '#E8E8E8';
                    e.currentTarget.style.borderColor = '#1A1A1A';
                  }}
                  onMouseLeave={(e) => {
                    e.currentTarget.style.background = '#F5F5F5';
                    e.currentTarget.style.borderColor = '#E8E8E8';
                  }}
                >
                  {item.name && item.email && (
                    <>
                      <div style={{ fontSize: '16px', fontWeight: '600', color: '#1A1A1A', marginBottom: '8px' }}>
                        {item.name}
                      </div>
                      <div style={{ fontSize: '12px', color: '#666', marginBottom: '12px' }}>
                        {item.email}
                      </div>
                      <div style={{ display: 'flex', gap: '16px', flexWrap: 'wrap', fontSize: '13px' }}>
                        <span><strong>Commits:</strong> {item.commits}</span>
                        <span><strong>Additions:</strong> +{item.additions.toLocaleString()}</span>
                        <span><strong>Deletions:</strong> -{item.deletions.toLocaleString()}</span>
                        <span><strong>Merges:</strong> {item.merges}</span>
                        {item.branches && <span><strong>Branches:</strong> {item.branches.length}</span>}
                      </div>
                    </>
                  )}

                  {item.name && !item.email && (
                    <>
                      <div
                        onClick={(e) => {
                          e.stopPropagation();
                          if (window.repoInfo) {
                            window.open(`https://github.com/${window.repoInfo.owner}/${window.repoInfo.repo}/tree/${item.name}`, '_blank');
                          }
                        }}
                        style={{
                          fontSize: '16px',
                          fontWeight: '600',
                          color: '#0077B6',
                          marginBottom: '8px',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '8px',
                          cursor: 'pointer',
                          textDecoration: 'underline'
                        }}
                      >
                        {item.name}
                        {item.isPrimary && (
                          <span style={{ background: '#1A1A1A', color: '#fff', padding: '2px 8px', fontSize: '11px', borderRadius: '4px' }}>
                            PRIMARY
                          </span>
                        )}
                      </div>
                    </>
                  )}

                  {item.hash && item.subject && (
                    <>
                      <div
                        onClick={(e) => {
                          e.stopPropagation();
                          if (window.repoInfo) {
                            window.open(`https://github.com/${window.repoInfo.owner}/${window.repoInfo.repo}/commit/${item.fullHash}`, '_blank');
                          }
                        }}
                        style={{
                          fontSize: '14px',
                          color: '#0077B6',
                          marginBottom: '8px',
                          cursor: 'pointer',
                          textDecoration: 'underline'
                        }}
                      >
                        {item.subject}
                      </div>
                      <div style={{ display: 'flex', gap: '16px', fontSize: '12px', color: '#666' }}>
                        <span>{item.hash}</span>
                        <span>{item.author}</span>
                        <span>{new Date(item.timestamp * 1000).toLocaleDateString()}</span>
                        {item.isMerge && (
                          <span style={{ background: '#7209B7', color: '#fff', padding: '2px 6px', borderRadius: '3px', fontSize: '11px' }}>
                            MERGE
                          </span>
                        )}
                      </div>
                    </>
                  )}
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    };

    const App = () => {
      const [repoUrl, setRepoUrl] = useState('');
      const [timeRange, setTimeRange] = useState('week');
      const [data, setData] = useState(null);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      const [currentIndex, setCurrentIndex] = useState(0);
      const [isPlaying, setIsPlaying] = useState(false);
      const [playbackSpeed, setPlaybackSpeed] = useState(1000);
      const [tooltip, setTooltip] = useState(null);
      const [showListModal, setShowListModal] = useState(null);
      const [repoInfo, setRepoInfo] = useState(null);
      const canvasRef = useRef(null);
      const timerRef = useRef(null);

      const timeRanges = [
        { value: 'day', label: 'Last 24 Hours' },
        { value: 'week', label: 'Last Week' },
        { value: 'month', label: 'Last Month' },
        { value: 'quarter', label: 'Last Quarter' },
        { value: '6months', label: 'Last 6 Months' },
        { value: 'year', label: 'Last Year' },
        { value: 'all', label: 'All Time' }
      ];

      useEffect(() => {
        if (isPlaying && data && data.graph && currentIndex < data.graph.length) {
          timerRef.current = setTimeout(() => {
            setCurrentIndex(prev => prev + 1);
          }, playbackSpeed);
        } else if (isPlaying && currentIndex >= data.graph.length) {
          setIsPlaying(false);
        }
        return () => clearTimeout(timerRef.current);
      }, [isPlaying, currentIndex, data, playbackSpeed]);

      useEffect(() => {
        if (!canvasRef.current || !data || !data.graph || currentIndex === 0) return;

        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');
        const nodes = data.graph.slice(0, currentIndex);

        const nodeSpacing = 60;
        const laneWidth = 80;
        const padding = 60;

        canvas.width = 1200;
        canvas.height = Math.max(nodes.length * nodeSpacing + padding * 2, 600);

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const lanes = new Map();
        const branchLanes = new Map();
        const primaryBranch = data.primaryBranch;
        const centerLane = 5;
        branchLanes.set(primaryBranch, centerLane);
        let nextLane = centerLane + 1;

        nodes.forEach((node, idx) => {
          const isOnPrimary = node.branches.includes(primaryBranch);
          if (isOnPrimary) {
            lanes.set(idx, centerLane);
          } else {
            let lane = null;
            for (const branch of node.branches) {
              if (branchLanes.has(branch)) {
                lane = branchLanes.get(branch);
                break;
              }
            }
            if (lane === null && node.branches[0]) {
              lane = nextLane++;
              branchLanes.set(node.branches[0], lane);
            }
            lanes.set(idx, lane || centerLane);
          }
        });

        const colors = ['#2D6A4F', '#C9184A', '#1A1A1A', '#7209B7', '#0077B6', '#FFC75F', '#FF6B9D', '#845EC2'];

        nodes.forEach((node, idx) => {
          const y = idx * nodeSpacing + padding;
          const lane = lanes.get(idx) || centerLane;
          const x = lane * laneWidth + padding + 200;

          node.parents.forEach(parentHash => {
            const parentIdx = nodes.findIndex(n => n.hash === parentHash);
            if (parentIdx !== -1 && parentIdx > idx) {
              const parentY = parentIdx * nodeSpacing + padding;
              const parentLane = lanes.get(parentIdx) || centerLane;
              const parentX = parentLane * laneWidth + padding + 200;
              const color = colors[lane % colors.length];

              ctx.strokeStyle = color;
              ctx.lineWidth = 3;
              ctx.globalAlpha = 0.6;
              ctx.beginPath();
              if (lane === parentLane) {
                ctx.moveTo(x, y);
                ctx.lineTo(parentX, parentY);
              } else {
                const midY = (y + parentY) / 2;
                ctx.moveTo(x, y);
                ctx.bezierCurveTo(x, midY, parentX, midY, parentX, parentY);
              }
              ctx.stroke();
              ctx.globalAlpha = 1;
            }
          });
        });

        nodes.forEach((node, idx) => {
          const y = idx * nodeSpacing + padding;
          const lane = lanes.get(idx) || centerLane;
          const x = lane * laneWidth + padding + 200;
          const isOnPrimary = node.branches.includes(primaryBranch);
          const color = colors[lane % colors.length];

          ctx.beginPath();
          ctx.arc(x, y, node.isMerge ? 7 : 5, 0, Math.PI * 2);
          ctx.fillStyle = isOnPrimary ? '#1A1A1A' : color;
          ctx.fill();
          ctx.strokeStyle = '#fff';
          ctx.lineWidth = 2;
          ctx.stroke();

          node._x = x;
          node._y = y;
          node._lane = lane;
        });

        branchLanes.forEach((lane, branchName) => {
          const x = lane * laneWidth + padding + 200;
          ctx.fillStyle = colors[lane % colors.length];
          ctx.font = 'bold 12px IBM Plex Mono';
          ctx.textAlign = 'center';
          ctx.fillText(branchName, x, 30);
        });

      }, [data, currentIndex]);

      const handleCanvasMouseMove = (e) => {
        if (!data || !data.graph) return;
        const canvas = canvasRef.current;
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        const my = e.clientY - rect.top;

        const nodes = data.graph.slice(0, currentIndex);
        let found = null;

        for (const node of nodes) {
          if (node._x && node._y) {
            const dx = mx - node._x;
            const dy = my - node._y;
            if (Math.sqrt(dx * dx + dy * dy) < 10) {
              found = node;
              break;
            }
          }
        }

        if (found) {
          const date = new Date(found.timestamp * 1000);
          setTooltip({
            x: e.clientX,
            y: e.clientY + window.scrollY,
            node: found,
            dateStr: date.toLocaleString('en-US', {
              month: 'short', day: 'numeric', year: 'numeric',
              hour: 'numeric', minute: '2-digit'
            })
          });
        } else {
          setTooltip(null);
        }
      };

      const analyzeRepository = async () => {
        if (!repoUrl.trim()) {
          setError('Please enter a repository URL');
          return;
        }
        setLoading(true);
        setError(null);
        setCurrentIndex(0);
        setIsPlaying(false);

        try {
          const response = await fetch('http://localhost:3002/api/analyze', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ repoUrl, timeRange })
          });
          if (!response.ok) throw new Error('Failed to analyze');
          const result = await response.json();
          // Extract owner/repo from URL
          const match = repoUrl.match(/github\.com[\/:]([^\/]+)\/([^\/\.]+)/);
          if (match) {
            setRepoInfo({ owner: match[1], repo: match[2] });
            window.repoInfo = { owner: match[1], repo: match[2] };
          }
          setData(result.data);
        } catch (err) {
          setError(err.message);
        } finally {
          setLoading(false);
        }
      };

      return (
        <div style={{ minHeight: '100vh', background: '#FAF9F6', padding: '40px 20px' }}>
          {tooltip && (
            <div className="tooltip" style={{ left: tooltip.x + 15, top: tooltip.y - 80 }}>
              <div><strong>{tooltip.node.author}</strong></div>
              <div>Branch: {tooltip.node.branches.join(', ') || 'none'}</div>
              <div>Commit: {tooltip.node.hash}</div>
              <div>Time: {tooltip.dateStr}</div>
              {tooltip.node.isMerge && <div style={{ marginTop: 4, padding: '2px 6px', background: '#7209B7', color: '#fff', borderRadius: 3, display: 'inline-block', fontSize: 11 }}>MERGE</div>}
              <div style={{ marginTop: 8, paddingTop: 8, borderTop: '1px solid #666', fontSize: 12, fontStyle: 'italic', color: '#ccc' }}>{tooltip.node.subject}</div>
            </div>
          )}

          <div style={{ maxWidth: '1400px', margin: '0 auto' }}>
            <h1 style={{ fontSize: '48px', fontWeight: '600', marginBottom: '40px', fontFamily: 'Literata, serif' }}>
              Git Repository Analyzer
            </h1>

            <div style={{ background: '#fff', border: '2px solid #E8E8E8', padding: '32px', marginBottom: '40px', borderRadius: '8px' }}>
              <div style={{ display: 'grid', gridTemplateColumns: '1fr auto', gap: '16px', marginBottom: '24px' }}>
                <div>
                  <label style={{ display: 'block', marginBottom: '8px', fontSize: '13px', fontWeight: '600', textTransform: 'uppercase' }}>Repository URL</label>
                  <input
                    type="text"
                    value={repoUrl}
                    onChange={(e) => setRepoUrl(e.target.value)}
                    placeholder="https://github.com/username/repository.git"
                    style={{ width: '100%', padding: '14px', fontSize: '15px', border: '2px solid #E8E8E8', background: '#FAFAFA' }}
                  />
                </div>
                <div>
                  <label style={{ display: 'block', marginBottom: '8px', fontSize: '13px', fontWeight: '600', textTransform: 'uppercase' }}>Time Range</label>
                  <select value={timeRange} onChange={(e) => setTimeRange(e.target.value)} style={{ padding: '14px', fontSize: '15px', border: '2px solid #E8E8E8', minWidth: '200px' }}>
                    {timeRanges.map(range => (
                      <option key={range.value} value={range.value}>{range.label}</option>
                    ))}
                  </select>
                </div>
              </div>
              <button onClick={analyzeRepository} disabled={loading} style={{ background: '#1A1A1A', color: '#fff', border: 'none', padding: '14px 32px', fontSize: '15px', fontWeight: '600', cursor: loading ? 'not-allowed' : 'pointer', borderRadius: '6px' }}>
                {loading ? 'ANALYZING...' : 'ANALYZE REPOSITORY'}
              </button>
              {error && <div style={{ marginTop: '16px', padding: '16px', background: '#FFE5E5', border: '2px solid #C9184A', color: '#8B0000', borderRadius: '6px' }}>Error: {error}</div>}
            </div>

            {data && (
              <>
                <div style={{ background: '#1A1A1A', color: '#fff', padding: '28px 32px', marginBottom: '40px', borderRadius: '8px', display: 'flex', justifyContent: 'space-between' }}>
                  <div>
                    <div style={{ fontSize: '14px', opacity: 0.7, marginBottom: '8px' }}>PRIMARY BRANCH</div>
                    <div style={{ fontSize: '32px', fontWeight: '700' }}>{data.primaryBranch}</div>
                  </div>
                  <div style={{ textAlign: 'right' }}>
                    <div style={{ fontSize: '14px', opacity: 0.7, marginBottom: '8px' }}>MERGES</div>
                    <div style={{ fontSize: '32px', fontWeight: '700' }}>{data.merges ? data.merges.length : 0}</div>
                  </div>
                </div>

                {data.branchingAnalysis && (
                  <div style={{ background: '#fff', border: '2px solid #E8E8E8', padding: '32px', marginBottom: '40px', borderRadius: '8px' }}>
                    <h3 style={{ margin: '0 0 24px', fontSize: '20px', fontWeight: '600' }}>ðŸ”€ Branching Analysis</h3>
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px', marginBottom: '24px' }}>
                      <div
                        onClick={() => setShowListModal({
                          type: 'info',
                          title: data.branchingAnalysis.strategy,
                          explanation: data.branchingAnalysis.strategyExplanation,
                          isInfo: true
                        })}
                        style={{
                          background: '#F5F5F5',
                          padding: '20px',
                          borderRadius: '8px',
                          borderLeft: '4px solid #1A1A1A',
                          cursor: 'pointer',
                          transition: 'all 0.2s'
                        }}
                        onMouseEnter={(e) => {
                          e.currentTarget.style.background = '#E8E8E8';
                          e.currentTarget.style.transform = 'translateY(-2px)';
                        }}
                        onMouseLeave={(e) => {
                          e.currentTarget.style.background = '#F5F5F5';
                          e.currentTarget.style.transform = 'translateY(0)';
                        }}
                      >
                        <div style={{ fontSize: '12px', color: '#666', marginBottom: '8px', textTransform: 'uppercase', fontWeight: '600' }}>
                          Strategy
                        </div>
                        <div style={{ fontSize: '22px', fontWeight: '700', color: '#1A1A1A' }}>{data.branchingAnalysis.strategy}</div>
                        <div style={{ fontSize: '11px', color: '#999', marginTop: '4px' }}>Click for details</div>
                      </div>
                      <div
                        onClick={() => setShowListModal({
                          type: 'info',
                          title: data.branchingAnalysis.workflow,
                          explanation: data.branchingAnalysis.workflowExplanation,
                          criteria: data.branchingAnalysis.detectionCriteria,
                          isInfo: true
                        })}
                        style={{
                          background: '#F5F5F5',
                          padding: '20px',
                          borderRadius: '8px',
                          borderLeft: '4px solid #7209B7',
                          cursor: 'pointer',
                          transition: 'all 0.2s'
                        }}
                        onMouseEnter={(e) => {
                          e.currentTarget.style.background = '#E8E8E8';
                          e.currentTarget.style.transform = 'translateY(-2px)';
                        }}
                        onMouseLeave={(e) => {
                          e.currentTarget.style.background = '#F5F5F5';
                          e.currentTarget.style.transform = 'translateY(0)';
                        }}
                      >
                        <div style={{ fontSize: '12px', color: '#666', marginBottom: '8px', textTransform: 'uppercase', fontWeight: '600' }}>
                          Workflow
                        </div>
                        <div style={{ fontSize: '22px', fontWeight: '700', color: '#1A1A1A' }}>{data.branchingAnalysis.workflow}</div>
                        <div style={{ fontSize: '11px', color: '#999', marginTop: '4px' }}>Click for details</div>
                      </div>
                    </div>
                    {data.branchingAnalysis.patterns.length > 0 && (
                      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '12px', marginBottom: '16px' }}>
                        {data.branchingAnalysis.patterns.map((p, i) => (
                          <div key={i} style={{ background: '#FAFAFA', border: '1px solid #E8E8E8', padding: '16px', borderRadius: '6px', display: 'flex', justifyContent: 'space-between' }}>
                            <span>{p.type}</span>
                            <span style={{ background: '#1A1A1A', color: '#fff', padding: '4px 12px', borderRadius: '12px', fontSize: '13px', fontWeight: '600' }}>{p.count}</span>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                )}

                {data.graph && data.graph.length > 0 && (
                  <div style={{ background: '#fff', border: '2px solid #E8E8E8', padding: '32px', marginBottom: '40px', borderRadius: '8px' }}>
                    <div style={{ marginBottom: '24px' }}>
                      <h3 style={{ margin: 0, fontSize: '20px', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '12px' }}>
                        ðŸŒ³ Branch Diagram
                        <span style={{ fontSize: '13px', background: '#F5F5F5', color: '#666', padding: '4px 12px', borderRadius: '4px', fontWeight: '500' }}>
                          {data.graph.length} commits
                        </span>
                      </h3>
                    </div>

                    <div
                      onClick={() => setShowListModal({
                        type: 'diagram',
                        title: 'Branch Diagram - Full View',
                        data: data.graph,
                        primaryBranch: data.primaryBranch,
                        isDiagram: true
                      })}
                      style={{
                        background: '#FAFAFA',
                        border: '1px solid #E8E8E8',
                        borderRadius: '8px',
                        overflow: 'hidden',
                        height: '400px',
                        cursor: 'pointer',
                        position: 'relative',
                        transition: 'all 0.2s'
                      }}
                      onMouseEnter={(e) => {
                        e.currentTarget.style.borderColor = '#1A1A1A';
                        e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
                      }}
                      onMouseLeave={(e) => {
                        e.currentTarget.style.borderColor = '#E8E8E8';
                        e.currentTarget.style.boxShadow = 'none';
                      }}
                    >
                      <BranchDiagram
                        commits={data.graph.slice(0, 50)}
                        primaryBranch={data.primaryBranch}
                        compact={true}
                      />
                      <div style={{
                        position: 'absolute',
                        bottom: '20px',
                        left: '50%',
                        transform: 'translateX(-50%)',
                        background: 'rgba(26, 26, 26, 0.9)',
                        color: '#fff',
                        padding: '8px 16px',
                        borderRadius: '6px',
                        fontSize: '13px',
                        fontWeight: '600'
                      }}>
                        Click to expand and see all commits
                      </div>
                    </div>

                    <div style={{ marginTop: '16px', padding: '12px', background: '#F5F5F5', fontSize: '12px', color: '#666', borderLeft: '3px solid #1A1A1A', borderRadius: '0 4px 4px 0' }}>
                      <strong>How to read:</strong> Each dot is a commit. Main branch runs through center. Lines show branch relationships. Click diagram to expand or click individual commits for details.
                    </div>
                  </div>
                )}

                <div style={{ maxWidth: '1400px', margin: '0 auto 40px', display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px' }}>
                  <div
                    onClick={() => setShowListModal({ type: 'contributors', data: data.contributors, title: `${data.contributors.length} Contributors` })}
                    style={{ background: '#FFFFFF', border: '2px solid #E8E8E8', padding: '24px', borderRadius: '8px', cursor: 'pointer', transition: 'all 0.2s' }}
                    onMouseEnter={(e) => { e.currentTarget.style.borderColor = '#1A1A1A'; e.currentTarget.style.transform = 'translateY(-2px)'; e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)'; }}
                    onMouseLeave={(e) => { e.currentTarget.style.borderColor = '#E8E8E8'; e.currentTarget.style.transform = 'translateY(0)'; e.currentTarget.style.boxShadow = 'none'; }}
                  >
                    <div style={{ fontSize: '36px', fontWeight: '700', marginBottom: '8px', color: '#1A1A1A' }}>{data.contributors.length}</div>
                    <div style={{ fontSize: '13px', letterSpacing: '1px', color: '#666' }}>CONTRIBUTORS</div>
                    <div style={{ fontSize: '11px', color: '#999', marginTop: '4px' }}>Click to view all</div>
                  </div>

                  <div
                    onClick={() => setShowListModal({ type: 'branches', data: data.branches, title: `${data.totalBranches} Branches` })}
                    style={{ background: '#FFFFFF', border: '2px solid #E8E8E8', padding: '24px', borderRadius: '8px', cursor: 'pointer', transition: 'all 0.2s' }}
                    onMouseEnter={(e) => { e.currentTarget.style.borderColor = '#1A1A1A'; e.currentTarget.style.transform = 'translateY(-2px)'; e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)'; }}
                    onMouseLeave={(e) => { e.currentTarget.style.borderColor = '#E8E8E8'; e.currentTarget.style.transform = 'translateY(0)'; e.currentTarget.style.boxShadow = 'none'; }}
                  >
                    <div style={{ fontSize: '36px', fontWeight: '700', marginBottom: '8px', color: '#1A1A1A' }}>{data.totalBranches || 0}</div>
                    <div style={{ fontSize: '13px', letterSpacing: '1px', color: '#666' }}>TOTAL BRANCHES</div>
                    <div style={{ fontSize: '11px', color: '#999', marginTop: '4px' }}>Click to view all</div>
                  </div>

                  <div
                    onClick={() => setShowListModal({ type: 'commits', data: data.graph, title: `${data.totalCommits.toLocaleString()} Commits` })}
                    style={{ background: '#FFFFFF', border: '2px solid #E8E8E8', padding: '24px', borderRadius: '8px', cursor: 'pointer', transition: 'all 0.2s' }}
                    onMouseEnter={(e) => { e.currentTarget.style.borderColor = '#1A1A1A'; e.currentTarget.style.transform = 'translateY(-2px)'; e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)'; }}
                    onMouseLeave={(e) => { e.currentTarget.style.borderColor = '#E8E8E8'; e.currentTarget.style.transform = 'translateY(0)'; e.currentTarget.style.boxShadow = 'none'; }}
                  >
                    <div style={{ fontSize: '36px', fontWeight: '700', marginBottom: '8px', color: '#1A1A1A' }}>{data.totalCommits.toLocaleString()}</div>
                    <div style={{ fontSize: '13px', letterSpacing: '1px', color: '#666' }}>TOTAL COMMITS</div>
                    <div style={{ fontSize: '11px', color: '#999', marginTop: '4px' }}>Click to view all</div>
                  </div>

                  <div style={{ background: '#FFFFFF', border: '2px solid #E8E8E8', padding: '24px', borderRadius: '8px' }}>
                    <div style={{ fontSize: '20px', fontWeight: '700', marginBottom: '8px', color: '#1A1A1A' }}>{data.timeRange}</div>
                    <div style={{ fontSize: '13px', letterSpacing: '1px', color: '#666' }}>TIME PERIOD</div>
                  </div>
                </div>
              </>
            )}

            {showListModal && (
              <SortableListModal
                title={showListModal.title}
                items={showListModal.data}
                explanation={showListModal.explanation}
                criteria={showListModal.criteria}
                isInfo={showListModal.isInfo}
                onClose={() => setShowListModal(null)}
              />
            )}
          </div>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>

</html>